# Quickstart: チャネル横断メモリシステム

**Date**: 2026-02-21
**Feature**: 002-cross-conversation-memory

## 概要

チャネル横断メモリシステムは、Slack・LINE・GitHub 等の
チャネルおよびスレッドを跨いで、プロジェクト単位の記憶を
自動的に蓄積・参照する機能です。

## 前提条件

- CLAPS が正常に動作していること
  （Slack Bot、LINE Bot が接続済み）
- `~/.claps/` ディレクトリが存在すること

## 基本的な使い方

### 1. 自動的なメモリ蓄積

特別な操作は不要です。CLAPS とチャネル経由で対話すると、
タスク完了時にメモリが自動的に蓄積されます。

```
[Slack] ユーザー: @claps プロジェクトAのAPIエンドポイントを整理して
→ CLAPS がタスクを実行し、結果を通知
→ メモリが自動的に ~/.claps/memory/development/backend/project-a/ に記録
→ セッション別メモリ MEMORY_<session_id>.md も作成
```

### 2. チャネル横断での記憶参照

Slack で指示した内容を LINE から確認できます。

```
[Slack] ユーザー: @claps 認証方式をJWTに変更して
→ CLAPS が実行、メモリに「認証方式をJWTに変更」が記録

--- 後日 ---

[LINE] ユーザー: プロジェクトAの認証方式は何だっけ？
→ CLAPS がメモリを参照し「JWTに変更済み」と回答
```

### 3. 明示的な記憶指示

特に覚えておいてほしい情報は明示的に指示できます。

```
[Slack] ユーザー: @claps 覚えておいて: デプロイは毎週火曜日の10時
→ pinned.md に記録（概要化されずに永続保持）
```

### 4. プロジェクト横断参照

別プロジェクトの知識を参照できます。

```
[Slack] ユーザー: @claps プロジェクトBの認証実装を参考にして、
プロジェクトAにも同じ方式を適用して
→ プロジェクトBのメモリも追加でロードされ、
  両方の知識を組み合わせて回答
```

## メモリディレクトリ構造

```
~/.claps/memory/
├── development/                # 抽象カテゴリ
│   └── backend/                # 具体カテゴリ
│       └── project-a/          # プロジェクト
│           ├── MEMORY.md       # 目次・概要 + Session ID 一覧
│           ├── MEMORY_abc123.md # セッション別メモリ
│           ├── pinned.md       # 固定記憶
│           ├── decisions.md    # 技術的決定事項
│           └── detail-*.md     # トピック別詳細
└── operations/
    └── infrastructure/
        └── project-b/
            ├── MEMORY.md
            ├── MEMORY_def456.md
            └── pinned.md
```

記憶の内容に基づいて「抽象カテゴリ → 具体カテゴリ → Project」の
階層で自動的に分類されます。上位ほど抽象的、下位ほど具体的な概念です。

## 設定

メモリシステムの動作は CLAPS の設定ファイルで調整可能です:

- **メモリ有効化**: デフォルトで有効
- **概要化閾値**: MEMORY.md がコンテキストウィンドウの
  10% を超えた場合に自動概要化
- **注入サイズ上限**: プロンプトに注入するメモリの最大サイズ
- **バックアップ保持数**: 概要化前バックアップの保持数（デフォルト 3）

## 動作確認手順

1. **メモリ蓄積の確認**:
   Slack で任意のタスクを実行後、
   `find ~/.claps/memory/ -name MEMORY.md` で
   カテゴリ階層配下にプロジェクトが作成されていることを確認

2. **チャネル横断の確認**:
   Slack で情報を伝えた後、LINE から同じ情報について質問し、
   正しく回答されることを確認

3. **固定記憶の確認**:
   「覚えておいて: (内容)」と指示した後、
   `cat ~/.claps/memory/projects/{name}/pinned.md` で
   内容が記録されていることを確認

4. **概要化の確認**:
   大量の対話を行い MEMORY.md のサイズが閾値を超えた後、
   古い情報が概要化され、固定記憶は保持されていることを確認

## トラブルシューティング

- **メモリが記録されない**:
  `~/.claps/memory/` ディレクトリの権限を確認
  （0700 であること）
- **ルーティングが誤る**:
  MEMORY.md のブロック引用行（description）が
  プロジェクトの内容を正しく反映しているか確認
- **概要化でデータが消えた**:
  `MEMORY.md.bak.*` ファイルから直近のバックアップを復元可能
