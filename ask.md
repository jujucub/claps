# 実装依頼内容
本ドキュメントは、新規機能実装に当たっての要望書である。

# 新機能について
新機能として、チャネル横断的なメモリ戦略を実装する。
現状では、マルチチャネル対応をしたものの、SlackやLINEを横断して共通のメモリを持っていない。そのため、Slackで指示したことをLINEで確認する、といった使い方ができない。

また、現状ではスレッドごとにメモリが分かれているため、「ひとりの人間」のように、スレッドをまたいでの共通の記憶がないことも問題である。
そこで、こうした問題を解消するためのメモリシステムを改修・実装する。

# 達成したいこと
前述のように、Slackで指示したことをLINEで確認したりといった横断的なメモリ（コンテキスト）を用意することが目的である。
しかしながら、現在のAIにおいてはコンテキスト長が課題となるケースも多く、単純にすべての記憶を共通として保持すると、すぐにコンテキストウィンドウがfullになってしまう可能性が高い。

そこで、以下の仕様に基づく階層的な記憶システムを考案する。これを実装する。

# メモリシステム
現在考案しているメモリシステムは、AgentのSkillsに着想を得ている。つまり、Memoryディレクトリ以下に階層構造を作る。
全体的なディレクトリ構造はほぼSkillsと同様の構成を想定する。具体的には、

```
└── Memory
    ├── LINE
    │   └── projects
    │       ├── projectA
            │   ├── ...
            │   └── MEMORY.md
    │       └── projectB
            │   ├── ...
            │   └── MEMORY.md
    └── Slack
        └── projects
            ├── channelA
            │   ├── MEMORY.md
            │   ├── hoge.txt
            │   └── reference.md
            └── thread1
                ├── MEMORY.md
                ├── fuga.txt
                └── reference.md
```

Skillsと同様、各チャネルやスレッドごとに分かれたディレクトリ構造以下に、MEMORY.mdを配置し、SKILL.mdと似たような内容を記載する。例えばエージェントが検索する際に参考にするDescriptionや、紐づく有用な情報などである。コンテキストを圧迫しないよう、短めに内容を記載し、実際の記憶情報や大事な情報は別ファイルに保存し、MEMORY.mdにはその目次を示すようにする。

## 概要化・更新について
各メモリ内容は検索され、参照された際にはそれを、対話の中で行われた内容によって更新する必要がある。
メモリは単なるスナップショットではなく、生きた記憶として刻まれる。

また、ただたんに追加して更新するだけではなく、人間の記憶と同様に一定の容量を超えないよう適宜概要化するなどして情報が爆発しないように考慮して更新する。
加えて、プロジェクト内で絶対に覚えておかないとならないものや、ユーザが明示的に覚えておいてほしいと話したものについては、専用ファイルを用意してそちらにメモを取る形とする。

## ルーティングと検索性について
やり取りが長時間になるとメモリ内容が膨大になることは容易に想像できる。そこで、ルーティングの役割をするエージェントを間に挟む。
ディレクトリ構造で触れなかったが、`projects`以下に配置されるディレクトリ名は、ルーティングを行うエージェントが決める。
もし適切なプロジェクト名が見つからない場合は新規作成する。
これは、プロジェクト単位でメモリを管理するが、会話の中で話されているプロジェクトとは別プロジェクトの内容を話題に出される可能性を考慮したものである。

例えば、プロジェクトAの開発を行っていて、ユーザと対話中、ユーザが「プロジェクトＢのあの実装を参考にしたい」といった発言をした際に、現在会話しているプロジェクト以外の記憶にもアクセスするパスを用意するためである。

----

これを実現する機能を、現在のメモリシステムを改修し、また新規となる部分については新規実装を行う。